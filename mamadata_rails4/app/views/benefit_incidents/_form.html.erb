<%= content_for :js do %><%= javascript_include_tag "benefit_incidents" %> <% end %>
<h2 class="text-right">New Incident</h2>
<%= form_for(@benefit_incident) do |f| %>
<%= f.hidden_field :person_id, value: @benefit_incident.person_id %>
<%= f.hidden_field :date_granted, value: @benefit_incident.date_granted %>
<div class="row">
	<div class="small-12 medium-4 columns"><%= f.label :program_id %></div>
	<div class="small-12 medium-8 columns"><%= f.select :program_id, @person.programs.map{|program| [program.name, program.id]}%></div>
</div>
<div class="row">
	<div class="small-12 medium-4 columns"><%= f.label :benefit_id %></div>
	<div class="small-12 medium-8 columns" id="benefit_select"><%= f.select :benefit_id, @benefits.map{|b| [b.name, b.id]}%></div>
</div>
<div class="row">
	<div class="small-12 medium-4 columns" id="amountlabel"><%= f.label :amount %></div>
	<div class="small-12 medium-8 columns"><%= f.text_field :amount %></div>
</div>
<div class="row">
	<div class="small-6 medium-4  columns"><%= f.label :remark %></div>
	<div class="small-12 medium-8 columns"><%= f.text_area :remark, size:"100x100", :id => "benefit_incident_remark" %></div>
	<div style="margin-top: -15px; margin-bottom: 5px; padding-right: 10px" class="text-right">
		<span id="txtLeft">500</span><span> of 500 chars left</span>
	</div>
</div>
<% if is_admin? %>
<div class="row">
	<div class="small-12 medium-4 columns"><%= f.label :status %></div>
	<% if @benefit_incident.status == 'true'%>
	<div class="small-12 medium-4 columns"><%= f.select :status, [['Granted',true],['Pending', false]], :selected =>  ['Granted', true] %></div>
	<% else %>
	<div class="small-12 medium-8 columns"><%= f.select :status, [['Granted',true],['Pending', false]], :selected =>  ['Pending', false] %></div>
	<% end %>
</div>
<% else %>
<%= f.hidden_field :status, value: @benefit_incident.status %>
<% end %>
<%= f.submit :class => 'button right' %>
<% end %>
<script>
var data = <%= @data.to_json.html_safe %>;
var allPrograms = <%= @all_programs.to_json.html_safe %>;
var allBenefits = <%= @all_benefits.to_json.html_safe %>;
var benefits_calculated =<%= @benefits_with_calculated_amount.to_json.html_safe %>;
var benefits_fixed =<%= @benefits_with_fixed_amount.to_json.html_safe %>;
var action = '<%= action_name %>';

var maxlengthTxt = 500;
var txt = 0;
$("#benefit_incident_remark").keyup(function (e) {
	txt = $(this).val();
	leftText = maxlengthTxt - txt.length;
	if (leftText <= 0) {
		$(this).val(txt.slice(0, maxlengthTxt));
	};
	$('#txtLeft').html(leftText);
})
</script>